
PLAY [Install Docker and Docker Compose on CentOS] *****************************

TASK [Gathering Facts] *********************************************************
ok: [159.69.156.48]
ok: [159.69.155.225]

TASK [initVMs : Update System] *************************************************
ok: [159.69.155.225]
ok: [159.69.156.48]

TASK [initVMs : Install OpenSSH (fixing for molecule)] *************************
ok: [159.69.156.48]
ok: [159.69.155.225]

TASK [initVMs : Get existing groups (idempotency)] *****************************
ok: [159.69.156.48]
ok: [159.69.155.225]

TASK [initVMs : Get existing users (idempotency)] ******************************
ok: [159.69.155.225]
ok: [159.69.156.48]

TASK [initVMs : Create SSH group] **********************************************
skipping: [159.69.155.225]
skipping: [159.69.156.48]

TASK [initVMs : Create SSH user] ***********************************************
skipping: [159.69.155.225]
skipping: [159.69.156.48]

TASK [initVMs : Set Docker user] ***********************************************
skipping: [159.69.155.225]
skipping: [159.69.156.48]

TASK [initVMs : Set SSH user key] **********************************************
ok: [159.69.156.48]
ok: [159.69.155.225]

TASK [initVMs : Set SSH user key in molecule] **********************************
skipping: [159.69.155.225]
skipping: [159.69.156.48]

TASK [initVMs : Ensure /etc/ssh exists (primarily done for molecule)] **********
ok: [159.69.156.48]
ok: [159.69.155.225]

TASK [initVMs : Stat /etc/ssh/sshd_config] *************************************
ok: [159.69.156.48]
ok: [159.69.155.225]

TASK [initVMs : SSH Config update] *********************************************
skipping: [159.69.155.225]
skipping: [159.69.156.48]

TASK [initVMs : Update SSH port in ssh config] *********************************
skipping: [159.69.155.225]
skipping: [159.69.156.48]

TASK [initVMs : allow to have passwordless sudo] *******************************
ok: [159.69.156.48] => (item=docker)
ok: [159.69.155.225] => (item=docker)
ok: [159.69.156.48] => (item=ettorefoti)
ok: [159.69.155.225] => (item=ettorefoti)

PLAY [Install Docker and Docker Compose on CentOS and set it up] ***************

TASK [Gathering Facts] *********************************************************
ok: [159.69.156.48]
ok: [159.69.155.225]

TASK [setupDocker : Check if Docker is installed] ******************************
changed: [159.69.156.48]
changed: [159.69.155.225]

TASK [setupDocker : Add Docker YUM Repository] *********************************
skipping: [159.69.155.225]
skipping: [159.69.156.48]

TASK [setupDocker : Install Docker and Yum Utils] ******************************
skipping: [159.69.155.225] => (item=yum-utils) 
skipping: [159.69.155.225] => (item=docker-ce) 
skipping: [159.69.155.225] => (item=docker-ce-cli) 
skipping: [159.69.155.225] => (item=containerd.io) 
skipping: [159.69.156.48] => (item=yum-utils) 
skipping: [159.69.156.48] => (item=docker-ce) 
skipping: [159.69.156.48] => (item=docker-ce-cli) 
skipping: [159.69.156.48] => (item=containerd.io) 

TASK [setupDocker : Enable the Docker daemon in systemd] ***********************
ok: [159.69.156.48]
ok: [159.69.155.225]

TASK [setupDocker : Start the Docker daemon] ***********************************
ok: [159.69.156.48]
ok: [159.69.155.225]

TASK [setupDocker : Check if Docker Compose is installed] **********************
changed: [159.69.156.48]
changed: [159.69.155.225]

TASK [setupDocker : debug] *****************************************************
ok: [159.69.155.225] => {
    "msg": "check: {'changed': True, 'end': '2022-01-18 08:26:22.624306', 'stdout': 'docker-compose version 1.21.2, build a133471', 'cmd': 'docker-compose --version', 'start': '2022-01-18 08:26:22.046540', 'delta': '0:00:00.577766', 'stderr': '', 'rc': 0, 'msg': '', 'stdout_lines': ['docker-compose version 1.21.2, build a133471'], 'stderr_lines': [], 'failed': False} and: -1"
}
ok: [159.69.156.48] => {
    "msg": "check: {'changed': True, 'end': '2022-01-18 08:26:22.489595', 'stdout': 'docker-compose version 1.21.2, build a133471', 'cmd': 'docker-compose --version', 'start': '2022-01-18 08:26:21.973057', 'delta': '0:00:00.516538', 'stderr': '', 'rc': 0, 'msg': '', 'stdout_lines': ['docker-compose version 1.21.2, build a133471'], 'stderr_lines': [], 'failed': False} and: -1"
}

TASK [setupDocker : Download and install Docker Compose] ***********************
ok: [159.69.155.225]
ok: [159.69.156.48]

TASK [setupDocker : Setup Docker REST API] *************************************
ok: [159.69.156.48]
ok: [159.69.155.225]

TASK [setupDocker : reload systemd] ********************************************
changed: [159.69.156.48]
changed: [159.69.155.225]

TASK [setupDocker : Start the Docker daemon] ***********************************
changed: [159.69.156.48]
changed: [159.69.155.225]

TASK [setupDocker : check lol] *************************************************
ok: [159.69.155.225] => (item=159.69.155.225) => {
    "msg": "dockernodes-001 159.69.155.225"
}
ok: [159.69.155.225] => (item=159.69.156.48) => {
    "msg": "dockernodes-002 159.69.156.48"
}
ok: [159.69.156.48] => (item=159.69.155.225) => {
    "msg": "dockernodes-001 159.69.155.225"
}
ok: [159.69.156.48] => (item=159.69.156.48) => {
    "msg": "dockernodes-002 159.69.156.48"
}

TASK [setupDocker : Configure Hosts File] **************************************
changed: [159.69.156.48] => (item=159.69.155.225)
changed: [159.69.155.225] => (item=159.69.155.225)
changed: [159.69.156.48] => (item=159.69.156.48)
changed: [159.69.155.225] => (item=159.69.156.48)

TASK [setupDocker : Copy Public Key Locally] ***********************************
changed: [159.69.156.48]
changed: [159.69.155.225]

TASK [setupDocker : Copy SSH Configuration] ************************************
ok: [159.69.156.48]
ok: [159.69.155.225]

TASK [setupDocker : empty known_hosts] *****************************************
changed: [159.69.156.48]
changed: [159.69.155.225]

TASK [setupDocker : run ssh-keyscan to add keys to known_hosts] ****************
changed: [159.69.156.48] => (item=159.69.155.225)
changed: [159.69.155.225] => (item=159.69.155.225)
changed: [159.69.156.48] => (item=159.69.156.48)
changed: [159.69.155.225] => (item=159.69.156.48)

TASK [setupDocker : Copy Public Key to Other Hosts] ****************************
ok: [159.69.156.48]
ok: [159.69.155.225]

TASK [setupDocker : Append Public key in authorized_keys file] *****************
ok: [159.69.156.48]
ok: [159.69.155.225]

PLAY [Setup Docker Swarm] ******************************************************

TASK [Gathering Facts] *********************************************************
ok: [159.69.155.225]

TASK [setupDockerSwarm : Check if Swarm has already been Initialized] **********
changed: [159.69.155.225]

TASK [setupDockerSwarm : Initialize Docker Swarm] ******************************
skipping: [159.69.155.225]

TASK [setupDockerSwarm : Get the Manager join-token] ***************************
changed: [159.69.155.225]

TASK [setupDockerSwarm : Get the worker join-token] ****************************
changed: [159.69.155.225]

PLAY [Generate Token and Join Workers] *****************************************

TASK [Gathering Facts] *********************************************************
ok: [159.69.156.48]

TASK [joinWorkers : Print the gateway for each host when defined] **************
ok: [159.69.156.48] => {
    "msg": "System 159.69.155.225"
}

TASK [joinWorkers : Fetch join token] ******************************************
changed: [159.69.156.48]

TASK [joinWorkers : Add Workers to the Swarm] **********************************
fatal: [159.69.156.48]: FAILED! => {"changed": true, "cmd": "bash /tmp/worker_join.sh", "delta": "0:00:10.106992", "end": "2022-01-18 08:27:28.471632", "msg": "non-zero return code", "rc": 1, "start": "2022-01-18 08:27:18.364640", "stderr": "/tmp/worker_join.sh: line 1: To: command not found\nError response from daemon: rpc error: code = Unavailable desc = connection error: desc = \"transport: authentication handshake failed: tls: first record does not look like a TLS handshake\"", "stderr_lines": ["/tmp/worker_join.sh: line 1: To: command not found", "Error response from daemon: rpc error: code = Unavailable desc = connection error: desc = \"transport: authentication handshake failed: tls: first record does not look like a TLS handshake\""], "stdout": "", "stdout_lines": []}

PLAY RECAP *********************************************************************
159.69.155.225             : ok=31   changed=11   unreachable=0    failed=0    skipped=9    rescued=0    ignored=0   
159.69.156.48              : ok=30   changed=9    unreachable=0    failed=1    skipped=8    rescued=0    ignored=0   

